<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯ - Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ© Ù„Ù„Ù…ÙˆØ§Ø´ÙŠ</title>
    <style>
        /* ========== Ù…ØªØºÙŠØ±Ø§Øª CSS ========== */
        :root {
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --primary-darker: #1a5276;
            --success-color: #27ae60;
            --success-dark: #219a52;
            --danger-color: #e74c3c;
            --danger-dark: #c0392b;
            --warning-color: #f39c12;
            --warning-dark: #e67e22;
            --info-color: #00cec9;
            --info-dark: #00b894;
            --dark-color: #2c3e50;
            --dark-light: #34495e;
            --light-bg: #f8f9fa;
            --light-border: #e1e8ed;
            --text-dark: #2d3436;
            --text-light: #6c757d;
            --shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            --shadow-light: 0 1px 4px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --radius-small: 6px;
        }

        /* ========== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 12px;
        }

        /* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== */
        .header {
            background: linear-gradient(to right, var(--primary-color), var(--primary-dark), var(--primary-darker));
            color: white;
            padding: 15px;
            border-radius: var(--radius);
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: "ğŸ‘";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
        }

        /* ========== Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== */
        .container {
            display: flex;
            gap: 12px;
            height: calc(100vh - 80px);
        }

        .sidebar {
            flex: 2; /* 20% */
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .main-content {
            flex: 8; /* 80% */
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* ========== Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ========== */
        .group-box {
            background: linear-gradient(to bottom, #ffffff, #f8f9fa);
            border: 1px solid var(--light-border);
            border-radius: var(--radius);
            padding: 12px 15px;
            margin-top: 8px;
            position: relative;
        }

        .group-box::before {
            content: attr(data-title);
            position: absolute;
            top: -8px;
            right: 50%;
            transform: translateX(50%);
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 6px 15px;
            border-radius: var(--radius-small);
            font-weight: bold;
            font-size: 11px;
            letter-spacing: 0.5px;
        }

        .group-box.info-group::before {
            background: linear-gradient(to bottom, var(--success-color), var(--success-dark));
        }

        .group-box.status-group::before {
            background: linear-gradient(to bottom, var(--danger-color), var(--danger-dark));
        }

        /* ========== Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ========== */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 15px;
        }

        .form-row {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-weight: bold;
            color: var(--dark-color);
            font-size: 11px;
            padding: 6px 0;
        }

        input, select, textarea {
            background: linear-gradient(to bottom, #ffffff, #f8f9fa);
            border: 1px solid var(--light-border);
            border-radius: var(--radius-small);
            padding: 6px 10px;
            font-size: 11px;
            color: var(--text-dark);
            min-height: 32px;
            font-weight: bold;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            background-color: #ffffff;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
            outline: none;
        }

        input:read-only {
            background-color: #f8f9fa;
            color: var(--text-light);
            border-color: #dee2e6;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
            font-family: inherit;
        }

        /* ========== Ø§Ù„Ø£Ø²Ø±Ø§Ø± ========== */
        .btn {
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 10px 16px;
            font-weight: bold;
            font-size: 11px;
            min-height: 32px;
            min-width: 90px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn:hover {
            background: linear-gradient(to bottom, var(--primary-dark), var(--primary-color));
            box-shadow: var(--shadow);
        }

        .btn:active {
            padding: 11px 16px 9px 16px;
            box-shadow: var(--shadow-light);
        }

        .btn-small {
            padding: 8px 12px;
            min-width: 70px;
            font-size: 10px;
            min-height: 28px;
        }

        .btn-success {
            background: linear-gradient(to bottom, var(--success-color), var(--success-dark));
        }

        .btn-success:hover {
            background: linear-gradient(to bottom, var(--success-dark), var(--success-color));
        }

        .btn-danger {
            background: linear-gradient(to bottom, var(--danger-color), var(--danger-dark));
        }

        .btn-danger:hover {
            background: linear-gradient(to bottom, var(--danger-dark), var(--danger-color));
        }

        .btn-warning {
            background: linear-gradient(to bottom, var(--warning-color), var(--warning-dark));
        }

        .btn-warning:hover {
            background: linear-gradient(to bottom, var(--warning-dark), var(--warning-color));
        }

        .btn-info {
            background: linear-gradient(to bottom, var(--info-color), var(--info-dark));
        }

        .btn-info:hover {
            background: linear-gradient(to bottom, var(--info-dark), var(--info-color));
        }

        .btn-dark {
            background: linear-gradient(to bottom, var(--dark-color), var(--dark-light));
        }

        .btn-dark:hover {
            background: linear-gradient(to bottom, var(--dark-light), var(--dark-color));
        }

        .btn:disabled {
            background: #95a5a6;
            color: #bdc3c7;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* ========== Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }

        .stat-card {
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 8px 10px;
            border: 1px solid #1a5276;
            border-radius: var(--radius);
            font-weight: bold;
            font-size: 10px;
            text-align: center;
            min-height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        /* ========== Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠ ========== */
        .control-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        /* ========== Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ========== */
        .tabs {
            display: flex;
            background: #f1f2f6;
            border-radius: var(--radius) var(--radius) 0 0;
            overflow: hidden;
        }

        .tab {
            background: linear-gradient(to bottom, #f1f2f6, #dfe4ea);
            border: 1px solid var(--light-border);
            padding: 8px 16px;
            margin-left: 2px;
            border-top-left-radius: var(--radius);
            border-top-right-radius: var(--radius);
            font-weight: bold;
            font-size: 10px;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .tab:hover:not(.active) {
            background: linear-gradient(to bottom, #dbe4e8, #c8d6e5);
        }

        .tab-content {
            display: none;
            background: white;
            border: 1px solid var(--light-border);
            border-top: none;
            border-radius: 0 0 var(--radius) var(--radius);
            flex: 1;
            overflow: auto;
        }

        .tab-content.active {
            display: block;
        }

        /* ========== Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ========== */
        .table-container {
            overflow: auto;
            border-radius: 0 0 var(--radius) var(--radius);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
            background: white;
        }

        th {
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 6px 4px;
            border: none;
            font-weight: bold;
            font-size: 10px;
            letter-spacing: 0.5px;
            text-align: center;
            position: sticky;
            top: 0;
        }

        td {
            padding: 4px 6px;
            border-bottom: 1px solid #f1f2f6;
            font-size: 10px;
            color: var(--text-dark);
            font-weight: bold;
            text-align: center;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #f1f2f6;
        }

        tr.existing {
            background-color: rgba(230, 255, 237, 0.5);
        }

        tr.ready {
            background-color: rgba(255, 250, 205, 0.5);
        }

        tr.sold {
            background-color: rgba(230, 245, 253, 0.5);
        }

        tr.dead {
            background-color: rgba(255, 235, 238, 0.5);
        }

        tr.lost {
            background-color: rgba(245, 245, 245, 0.5);
        }

        /* ========== Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: linear-gradient(to right, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 15px;
            border-radius: var(--radius) var(--radius) 0 0;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 15px;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            border-top: 1px solid var(--light-border);
        }

        /* ========== Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ========== */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .control-bar {
                flex-wrap: wrap;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: 100px;
                text-align: center;
            }
        }

        /* ========== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± ========== */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f2f6;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c8d6e5;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="header">ğŸ‘ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯ - Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ© Ù„Ù„Ù…ÙˆØ§Ø´ÙŠ</div>

    <!-- Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="container">
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (20%) -->
        <div class="sidebar">
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ„ÙˆØ¯ Ø¬Ø¯ÙŠØ¯ -->
            <div class="group-box" data-title="ğŸ“ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ„ÙˆØ¯ Ø¬Ø¯ÙŠØ¯">
                <div class="form-grid">
                    <!-- Ø§Ù„ØµÙ 1: Ø§Ù„Ø­Ø¸ÙŠØ±Ø© -->
                    <div class="form-row">
                        <label for="barn-combo">Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©:</label>
                        <select id="barn-combo">
                            <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¸Ø§Ø¦Ø±...</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="barn-code">ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¸ÙŠØ±Ø©:</label>
                        <input type="text" id="barn-code" readonly>
                    </div>

                    <!-- Ø§Ù„ØµÙ 2: Ø§Ù„Ø£Ù… ÙˆØ§Ù„Ø¬Ù†Ø³ -->
                    <div class="form-row">
                        <label for="mother-code-combo">ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…:</label>
                        <select id="mother-code-combo">
                            <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£Ù…Ù‡Ø§Øª...</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="gender-combo">Ø§Ù„Ø¬Ù†Ø³:</label>
                        <select id="gender-combo">
                            <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
                            <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
                        </select>
                    </div>

                    <!-- Ø§Ù„ØµÙ 3: Ø§Ù„ØªÙˆØ£Ù… ÙˆÙ…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ -->
                    <div class="form-row">
                        <label for="twin-combo">Ø§Ù„ØªÙˆØ£Ù…:</label>
                        <select id="twin-combo">
                            <option value="Ù†Ø¹Ù…">Ù†Ø¹Ù…</option>
                            <option value="Ù„Ø§" selected>Ù„Ø§</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="birth-place-combo">Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</label>
                        <select id="birth-place-combo">
                            <option value="ÙÙŠ Ø§Ù„Ø­Ø¸ÙŠØ±Ø©">ÙÙŠ Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</option>
                            <option value="ÙÙŠ Ø§Ù„Ù…Ø­Ù…ÙŠØ©">ÙÙŠ Ø§Ù„Ù…Ø­Ù…ÙŠØ©</option>
                        </select>
                    </div>

                    <!-- Ø§Ù„ØµÙ 4: Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ -->
                    <div class="form-row">
                        <label for="status-combo">Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                        <select id="status-combo">
                            <option value="Ø­ÙŠ">Ø­ÙŠ</option>
                            <option value="Ù…ÙŠØª">Ù…ÙŠØª</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label for="birth-date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</label>
                        <input type="date" id="birth-date">
                    </div>

                    <!-- Ø§Ù„ØµÙ 5: Ø§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯ -->
                    <div class="form-row">
                        <label for="age-label">Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±:</label>
                        <div id="age-label" class="stat-card">0 Ø´Ù‡Ø±</div>
                    </div>
                    <div class="form-row">
                        <label for="newborn-code">ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯:</label>
                        <input type="text" id="newborn-code" readonly>
                    </div>

                    <!-- Ø§Ù„ØµÙ 6: Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ -->
                    <div class="form-row" style="grid-column: 1 / span 2;">
                        <label for="newborn-card">Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯:</label>
                        <input type="text" id="newborn-card" readonly>
                    </div>

                    <!-- Ø§Ù„ØµÙ 7: Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                    <div class="form-row" style="grid-column: 1 / span 2;">
                        <label for="notes">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                        <textarea id="notes" placeholder="Ø£Ø¯Ø®Ù„ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù‡Ù†Ø§..."></textarea>
                    </div>

                    <!-- Ø§Ù„ØµÙ 8: Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
                    <div class="form-row" style="grid-column: 1 / span 2; display: flex; flex-direction: row; gap: 10px; margin-top: 10px;">
                        <button id="btn-generate" class="btn btn-info btn-small">ğŸ”„ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</button>
                        <div style="flex: 1;"></div>
                        <button id="btn-save" class="btn btn-success btn-small">ğŸ’¾ Ø­ÙØ¸</button>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
            <div class="group-box info-group" data-title="ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª">
                <div class="stats-grid">
                    <div id="total-label" class="stat-card">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯: 0</div>
                    <div id="males-label" class="stat-card">Ø§Ù„Ø°ÙƒÙˆØ±: 0</div>
                    <div id="females-label" class="stat-card">Ø§Ù„Ø¥Ù†Ø§Ø«: 0</div>
                    <div id="existing-label" class="stat-card">Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯: 0</div>
                    <div id="ready-label" class="stat-card">Ø§Ù„Ø¬Ø§Ù‡Ø²: 0</div>
                    <div id="sold-label" class="stat-card">Ø§Ù„Ù…Ø¨Ø§Ø¹: 0</div>
                    <div id="dead-label" class="stat-card">Ø§Ù„Ù†Ø§ÙÙ‚: 0</div>
                    <div id="lost-label" class="stat-card">Ø§Ù„Ù…ÙÙ‚ÙˆØ¯: 0</div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (80%) -->
        <div class="main-content">
            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
            <div class="control-bar">
                <button id="btn-back" class="btn btn-dark btn-small">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
                <button id="btn-refresh" class="btn btn-primary btn-small">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                <button id="btn-auto-update" class="btn btn-info btn-small">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø§Øª</button>
                <button id="btn-delete-selected" class="btn btn-danger btn-small">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            </div>

            <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
            <div class="tabs">
                <div class="tab active" data-tab="all">ğŸ Ø§Ù„ÙƒÙ„</div>
                <div class="tab" data-tab="existing">âœ… Ù…ÙˆØ¬ÙˆØ¯</div>
                <div class="tab" data-tab="ready">ğŸš€ Ø¬Ø§Ù‡Ø²</div>
                <div class="tab" data-tab="sold">ğŸ’° Ù…Ø¨Ø§Ø¹</div>
                <div class="tab" data-tab="dead">ğŸ’€ Ù†Ø§ÙÙ‚</div>
                <div class="tab" data-tab="lost">ğŸ” Ù…ÙÙ‚ÙˆØ¯</div>
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
            <div class="tab-content active" id="all-tab">
                <div class="table-container">
                    <table id="all-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…</th>
                                <th>Ø§Ù„Ø¬Ù†Ø³</th>
                                <th>Ø§Ù„ØªÙˆØ£Ù…</th>
                                <th>Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>Ø§Ù„Ø¹Ù…Ø±</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="existing-tab">
                <div class="table-container">
                    <table id="existing-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…</th>
                                <th>Ø§Ù„Ø¬Ù†Ø³</th>
                                <th>Ø§Ù„ØªÙˆØ£Ù…</th>
                                <th>Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>Ø§Ù„Ø¹Ù…Ø±</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="ready-tab">
                <div class="table-container">
                    <table id="ready-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…</th>
                                <th>Ø§Ù„Ø¬Ù†Ø³</th>
                                <th>Ø§Ù„ØªÙˆØ£Ù…</th>
                                <th>Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>Ø§Ù„Ø¹Ù…Ø±</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="sold-tab">
                <div class="table-container">
                    <table id="sold-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…</th>
                                <th>Ø§Ù„Ø¬Ù†Ø³</th>
                                <th>Ø§Ù„ØªÙˆØ£Ù…</th>
                                <th>Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>Ø§Ù„Ø¹Ù…Ø±</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="dead-tab">
                <div class="table-container">
                    <table id="dead-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…</th>
                                <th>Ø§Ù„Ø¬Ù†Ø³</th>
                                <th>Ø§Ù„ØªÙˆØ£Ù…</th>
                                <th>Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>Ø§Ù„Ø¹Ù…Ø±</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-content" id="lost-tab">
                <div class="table-container">
                    <table id="lost-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…</th>
                                <th>Ø§Ù„Ø¬Ù†Ø³</th>
                                <th>Ø§Ù„ØªÙˆØ£Ù…</th>
                                <th>Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                <th>Ø§Ù„Ø¹Ù…Ø±</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                                <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯</div>
            <div class="modal-body">
                <div class="group-box info-group" data-title="ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯" style="margin-bottom: 15px;">
                    <div class="form-grid">
                        <div class="form-row">
                            <label>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯:</label>
                            <div id="edit-newborn-code" class="stat-card"></div>
                        </div>
                        <div class="form-row">
                            <label>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</label>
                            <div id="edit-newborn-card" class="stat-card"></div>
                        </div>
                        <div class="form-row">
                            <label>ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…:</label>
                            <div id="edit-mother-code" class="stat-card"></div>
                        </div>
                    </div>
                </div>
                
                <div class="group-box status-group" data-title="ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©">
                    <div class="form-row">
                        <label for="edit-status-combo">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label>
                        <select id="edit-status-combo">
                            <option value="Ù…ÙˆØ¬ÙˆØ¯">Ù…ÙˆØ¬ÙˆØ¯</option>
                            <option value="Ø¬Ø§Ù‡Ø²">Ø¬Ø§Ù‡Ø²</option>
                            <option value="Ù…Ø¨Ø§Ø¹">Ù…Ø¨Ø§Ø¹</option>
                            <option value="Ù†Ø§ÙÙ‚">Ù†Ø§ÙÙ‚</option>
                            <option value="Ù…ÙÙ‚ÙˆØ¯">Ù…ÙÙ‚ÙˆØ¯</option>
                        </select>
                    </div>
                    
                    <div style="background: linear-gradient(to bottom, #fff3cd, #ffeaa7); border: 1px solid #ffd43b; border-radius: var(--radius-small); padding: 12px; color: #856404; font-size: 10px; line-height: 1.4; margin-top: 15px;">
                        <strong>ğŸ’¡ Ø´Ø±Ø­ Ø§Ù„Ø­Ø§Ù„Ø§Øª:</strong><br>
                        â€¢ <b>Ù…ÙˆØ¬ÙˆØ¯:</b> Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©<br>
                        â€¢ <b>Ø¬Ø§Ù‡Ø²:</b> Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨ÙŠØ¹ (Ø¹Ù…Ø±Ù‡ 3 Ø£Ø´Ù‡Ø± Ø£Ùˆ Ø£ÙƒØ«Ø±)<br>
                        â€¢ <b>Ù…Ø¨Ø§Ø¹:</b> ØªÙ… Ø¨ÙŠØ¹ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯<br>
                        â€¢ <b>Ù†Ø§ÙÙ‚:</b> Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ù†Ø§ÙÙ‚<br>
                        â€¢ <b>Ù…ÙÙ‚ÙˆØ¯:</b> Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ù…ÙÙ‚ÙˆØ¯
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-save-edit" class="btn btn-success">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
                <button id="btn-cancel-edit" class="btn btn-danger">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù -->
    <div id="delete-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</div>
            <div class="modal-body">
                <p id="delete-message">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ØŸ</p>
            </div>
            <div class="modal-footer">
                <button id="btn-confirm-delete" class="btn btn-danger">Ù†Ø¹Ù…ØŒ Ø­Ø°Ù</button>
                <button id="btn-cancel-delete" class="btn btn-primary">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================================
        //                ğŸŸ¦ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        // ==========================================================
        let newbornData = [];
        let barnsData = [];
        let currentEditId = null;
        let currentDeleteId = null;

        // ==========================================================
        //                ğŸŸ¦ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ==========================================================
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadInitialData();
            
            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            setInterval(autoUpdateStatusByAge, 60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
            setInterval(loadNewbornData, 30000); // ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
        });

        function initializeApp() {
            // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('birth-date').value = today;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            calculateAge();
            
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            generateCodes();
        }

        function setupEventListeners() {
            // Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('birth-date').addEventListener('change', calculateAge);
            document.getElementById('barn-combo').addEventListener('change', onBarnSelected);
            document.getElementById('mother-code-combo').addEventListener('change', generateCodes);
            document.getElementById('gender-combo').addEventListener('change', generateCodes);
            document.getElementById('twin-combo').addEventListener('change', generateCodes);
            document.getElementById('btn-generate').addEventListener('click', generateCodes);
            document.getElementById('btn-save').addEventListener('click', saveNewborn);
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ­ÙƒÙ…
            document.getElementById('btn-refresh').addEventListener('click', loadNewbornData);
            document.getElementById('btn-auto-update').addEventListener('click', manualAutoUpdate);
            document.getElementById('btn-delete-selected').addEventListener('click', deleteSelectedNewborn);
            document.getElementById('btn-back').addEventListener('click', goBack);
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            document.getElementById('btn-save-edit').addEventListener('click', saveEdit);
            document.getElementById('btn-cancel-edit').addEventListener('click', closeEditModal);
            document.getElementById('btn-confirm-delete').addEventListener('click', confirmDelete);
            document.getElementById('btn-cancel-delete').addEventListener('click', closeDeleteModal);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('edit-modal')) {
                    closeEditModal();
                }
                if (event.target === document.getElementById('delete-modal')) {
                    closeDeleteModal();
                }
            });
        }

        // ==========================================================
        //                ğŸŸ¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        // ==========================================================
        function getLocalStorage(key, defaultValue = null) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ:', e);
                return defaultValue;
            }
        }

        function setLocalStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ:', e);
            }
        }

        // ==========================================================
        //                ğŸŸ¦ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        // ==========================================================
        function loadInitialData() {
            loadBarnsData();
            loadNewbornData();
            
            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            setTimeout(autoUpdateStatusByAge, 5000);
        }

        function loadBarnsData() {
            // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¸Ø§Ø¦Ø± - Ù†ÙØ¶Ù‘Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… `barnsData` Ù…Ù† ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø£ØºÙ†Ø§Ù… Ø¥Ù† ÙˆÙØ¬Ø¯Øª
            const barnsFromSheepApp = getLocalStorage('barnsData', null);
            if (barnsFromSheepApp && Array.isArray(barnsFromSheepApp) && barnsFromSheepApp.length > 0) {
                barnsData = barnsFromSheepApp.map(b => {
                    // Normalize keys to expected shape (number, name, capacity...)
                    return {
                        id: b.id || b._id || null,
                        number: b.barnNumber || b.number || b.id || '',
                        name: b.barnName || b.name || b.barnName || '',
                        capacity: b.totalCapacity || b.capacity || b.totalCapacity || 0,
                        location: b.location || b.barnLocation || '',
                        maleCount: b.maleCount || b.maleQty || 0,
                        femaleCount: b.femaleCount || b.femaleQty || 0,
                        unitPrice: b.unitPrice || 0,
                        breed: b.breed || b.animalType || '',
                        type: b.type || b.gender || '',
                        purchaseDate: b.purchaseDate || b.gregorianDate || ''
                    };
                });
            } else {
                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£ØºÙ†Ø§Ù…
                const barns = getLocalStorage('barns', []);
                if (barns.length === 0) {
                    const defaultBarns = [
                        { id: 1, number: 1, name: "Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø´Ù…Ø§Ù„", capacity: 50, location: "Ø§Ù„Ø´Ù…Ø§Ù„" },
                        { id: 2, number: 2, name: "Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø¬Ù†ÙˆØ¨", capacity: 40, location: "Ø§Ù„Ø¬Ù†ÙˆØ¨" },
                        { id: 3, number: 3, name: "Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø´Ø±Ù‚", capacity: 60, location: "Ø§Ù„Ø´Ø±Ù‚" },
                        { id: 4, number: 4, name: "Ø­Ø¸ÙŠØ±Ø© Ø§Ù„ØºØ±Ø¨", capacity: 45, location: "Ø§Ù„ØºØ±Ø¨" }
                    ];
                    setLocalStorage('barns', defaultBarns);
                    barnsData = defaultBarns;
                } else {
                    barnsData = barns;
                }
            }

            updateBarnsCombo();
        }

        function updateBarnsCombo() {
            const barnCombo = document.getElementById('barn-combo');
            barnCombo.innerHTML = '';
            
            if (barnsData.length === 0) {
                barnCombo.innerHTML = '<option value="">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¸Ø§Ø¦Ø±</option>';
                return;
            }
            
            barnsData.forEach(barn => {
                const option = document.createElement('option');
                option.value = barn.number;
                option.textContent = `${barn.name} (Ø±Ù‚Ù…: ${barn.number})`;
                barnCombo.appendChild(option);
            });
            
            // ØªØ­Ø¯ÙŠØ« ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            onBarnSelected();
        }

        function onBarnSelected() {
            const barnNumber = document.getElementById('barn-combo').value;
            if (barnNumber) {
                document.getElementById('barn-code').value = `B${barnNumber.padStart(3, '0')}`;
                loadMotherCodes(barnNumber);
            } else {
                document.getElementById('barn-code').value = '';
            }
            generateCodes();
        }

        function loadMotherCodes(barnNumber) {
            // Ø¬Ù„Ø¨ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£Ù…Ù‡Ø§Øª Ù…Ù† Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£ØºÙ†Ø§Ù… (sheepData) Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªÙˆÙØ±Ø©
            const sheep = getLocalStorage('sheepData', []);
            const motherCombo = document.getElementById('mother-code-combo');
            motherCombo.innerHTML = '';

            if (!sheep || sheep.length === 0) {
                motherCombo.innerHTML = '<option value="">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ø£Ù…Ù‡Ø§Øª</option>';
                generateCodes();
                return;
            }

            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£Ù…Ù‡Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø© Ù„Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            // Ù†Ø±ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠ Ø¨Ù€ -Mxxx Ø£Ùˆ -Fxxx (Ù…Ø«Ø§Ù„: '-M004') ÙƒÙ†ØµØŒ
            // Ù„ÙƒÙ† Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ÙÙŠ `value` Ø­ØªÙ‰ ØªØ¨Ù‚Ù‰ Ù…Ù†Ø·Ù‚ÙŠØ© Ù„Ù„Ø­ÙØ¸.
            const codesMap = new Map(); // key: displayedSuffix, value: fullCode (first seen)
            sheep.forEach(s => {
                try {
                    if (String(s.barnNumber) === String(barnNumber) && s.motherCode) {
                        const full = String(s.motherCode).trim();
                        // Ø§Ø³ØªØ¨Ø¹Ø¯ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© '002-0001'
                        if (full === '002-0001') return;

                        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù„Ø§Ø­Ù‚Ø© '-M###' Ø£Ùˆ '-F###' ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙƒÙˆØ¯
                        const m = full.match(/-(?:M|F)\d+$/i);
                        if (m) {
                            const suffix = m[0]; // ÙŠØªØ¶Ù…Ù† Ø§Ù„Ø´Ø±Ø·Ø©ØŒ Ù…Ø«Ø§Ù„ '-M004'
                                if (!codesMap.has(suffix)) codesMap.set(suffix, full);
                        } else {
                            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù„Ø§Ø­Ù‚Ø©ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ù…Ù„ ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶
                            if (!codesMap.has(full)) codesMap.set(full, full);
                        }
                    }
                } catch (e) {
                    // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                }
            });

            if (codesMap.size === 0) {
                motherCombo.innerHTML = '<option value="">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ø£Ù…Ù‡Ø§Øª</option>';
            } else {
                motherCombo.innerHTML = '';
                codesMap.forEach((fullCode, displayText) => {
                    const option = document.createElement('option');
                    option.value = fullCode; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ØªØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸Ø©
                        let display = displayText;
                        try { display = display.replace(/^-/,''); } catch(e) {}
                        option.textContent = display;
                    motherCombo.appendChild(option);
                });
            }

            generateCodes();
        }

        function loadNewbornData() {
            newbornData = getLocalStorage('newborns', []);
            updateAllTables();
            updateStatistics();
        }

        // ==========================================================
        //                ğŸŸ¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
        // ==========================================================
        function calculateAge() {
            const birthDate = new Date(document.getElementById('birth-date').value);
            const today = new Date();
            
            let months = (today.getFullYear() - birthDate.getFullYear()) * 12;
            months -= birthDate.getMonth();
            months += today.getMonth();
            
            document.getElementById('age-label').textContent = `${months} Ø´Ù‡Ø±`;
        }

        function generateCodes() {
            const barnCode = document.getElementById('barn-code').value;
            const motherCode = document.getElementById('mother-code-combo').value;
            // Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ (Ù…Ø«Ù„ 'M004') Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù†ØµÙŠ Ø¥Ù† ÙˆÙØ¬Ø¯ØŒ ÙˆØ¥Ù„Ø§ Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù„Ø§Ø­Ù‚Ø© Ù…Ù† Ø§Ù„Ù‚ÙŠÙ…Ø©
            let displayMother = '';
            try {
                const select = document.getElementById('mother-code-combo');
                const opt = select.options[select.selectedIndex];
                if (opt && opt.textContent) {
                    displayMother = opt.textContent.trim();
                }
                if (!displayMother) {
                    const m = String(motherCode).match(/-(?:M|F)\d+$/i);
                    if (m) displayMother = m[0].replace(/^-/, '');
                }
            } catch (e) {
                displayMother = '';
            }
            
            // ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ
            const nextCode = getNextNewbornCode();
            document.getElementById('newborn-code').value = nextCode.toString().padStart(5, '0');
            
            // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
            let cardNumber = '';
            if (barnCode) {
                if (motherCode && motherCode !== "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ø£Ù…Ù‡Ø§Øª") {
                    // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ (Ù…Ø«Ù„ 'M004') ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ø·Ø§Øª Ù…Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
                    const cleanMotherCode = displayMother || motherCode.replace(/-/g, '').replace(/ /g, '');
                    cardNumber = `${barnCode}/${cleanMotherCode}/${nextCode.toString().padStart(5, '0')}`;
                } else {
                    cardNumber = `${barnCode}/NB/${nextCode.toString().padStart(5, '0')}`;
                }
            }
            document.getElementById('newborn-card').value = cardNumber;
        }

        function getNextNewbornCode() {
            const newborns = getLocalStorage('newborns', []);
            if (newborns.length === 0) return 10001;
            
            const maxCode = Math.max(...newborns.map(n => parseInt(n.newbornCode) || 0));
            return Math.max(maxCode + 1, 10001);
        }

        function saveNewborn() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!validateForm()) return;
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            const barnNumber = document.getElementById('barn-combo').value;
            const motherCode = document.getElementById('mother-code-combo').value;
            const gender = document.getElementById('gender-combo').value;
            const twin = document.getElementById('twin-combo').value;
            const birthPlace = document.getElementById('birth-place-combo').value;
            const status = document.getElementById('status-combo').value;
            const birthDate = document.getElementById('birth-date').value;
            const ageMonths = parseInt(document.getElementById('age-label').textContent.replace(' Ø´Ù‡Ø±', ''));
            const barnCode = document.getElementById('barn-code').value;
            const newbornCode = document.getElementById('newborn-code').value;
            const newbornCard = document.getElementById('newborn-card').value;
            const notes = document.getElementById('notes').value;
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø¨Ø³ÙŠØ·Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
            const statusMap = {
                "Ø­ÙŠ": "Ù…ÙˆØ¬ÙˆØ¯",
                "Ù…ÙŠØª": "Ù†Ø§ÙÙ‚"
            };
            let detailedStatus = statusMap[status] || "Ù…ÙˆØ¬ÙˆØ¯";
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ø± >= 3 Ø£Ø´Ù‡Ø±ØŒ Ø§Ø¶Ø¨Ø· Ø§Ù„Ø­Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù„Ù‰ 'Ø¬Ø§Ù‡Ø²'
            if (ageMonths >= 3) {
                detailedStatus = 'Ø¬Ø§Ù‡Ø²';
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± ÙƒÙˆØ¯ Ø§Ù„Ø£Ù… Ù…Ø§ Ù„Ù… ÙŠÙƒÙ† ØªÙˆØ£Ù…Ø§Ù‹
            if (motherCode && twin !== 'Ù†Ø¹Ù…') {
                const existingWithSameMother = newbornData.find(n => n.motherCode === motherCode);
                if (existingWithSameMother) {
                    alert('ÙƒÙˆØ¯ Ø§Ù„Ø£Ù… Ù…ÙƒØ±Ø±: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ„ÙˆØ¯ Ø¬Ø¯ÙŠØ¯ Ø¨Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„Ø£Ù… Ù…Ø§ Ù„Ù… ÙŠÙƒÙ† ØªÙˆØ£Ù…Ø§Ù‹. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ø£Ù… Ø£Ùˆ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙˆØ£Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† ØµØ­ÙŠØ­Ø§Ù‹.');
                    return;
                }
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            const newNewborn = {
                id: Date.now(), // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ ÙƒÙ…Ø¹Ø±Ù ÙØ±ÙŠØ¯
                barnNumber: parseInt(barnNumber),
                motherCode: motherCode,
                gender: gender,
                twin: twin,
                birthPlace: birthPlace,
                birthDate: birthDate,
                ageMonths: ageMonths,
                status: detailedStatus,
                barnCode: barnCode,
                newbornCode: newbornCode,
                newbornCard: newbornCard,
                notes: notes,
                addedDate: new Date().toISOString()
            };
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            newbornData.push(newNewborn);
            setLocalStorage('newborns', newbornData);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            resetForm();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateAllTables();
            updateStatistics();
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
            alert('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function validateForm() {
            const barnNumber = document.getElementById('barn-combo').value;
            const motherCode = document.getElementById('mother-code-combo').value;
            
            if (!barnNumber) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø¸ÙŠØ±Ø©');
                return false;
            }
            
            if (!motherCode || motherCode === "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£Ù…Ù‡Ø§Øª..." || 
                motherCode === "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£Ù…Ù‡Ø§Øª" || motherCode === "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ø£Ù…Ù‡Ø§Øª") {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…');
                return false;
            }
            
            return true;
        }

        function resetForm() {
            document.getElementById('notes').value = '';
            document.getElementById('birth-date').value = new Date().toISOString().split('T')[0];
            calculateAge();
            generateCodes();
        }

        // ==========================================================
        //                ğŸŸ¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
        // ==========================================================
        function updateAllTables() {
            updateTable('all-table', newbornData);
            updateTable('existing-table', newbornData.filter(n => n.status === 'Ù…ÙˆØ¬ÙˆØ¯'));
            updateTable('ready-table', newbornData.filter(n => n.status === 'Ø¬Ø§Ù‡Ø²'));
            updateTable('sold-table', newbornData.filter(n => n.status === 'Ù…Ø¨Ø§Ø¹'));
            updateTable('dead-table', newbornData.filter(n => n.status === 'Ù†Ø§ÙÙ‚'));
            updateTable('lost-table', newbornData.filter(n => n.status === 'Ù…ÙÙ‚ÙˆØ¯'));
        }

        function updateTable(tableId, data) {
            const table = document.getElementById(tableId);
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="14" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td>`;
                tbody.appendChild(row);
                return;
            }
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯
            const sortedData = [...data].sort((a, b) => {
                const codeA = a.newbornCode || '';
                const codeB = b.newbornCode || '';
                return codeA.localeCompare(codeB);
            });
            
            sortedData.forEach((newborn, index) => {
                const row = document.createElement('tr');
                row.className = newborn.status;
                
                // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
                const formatDate = (dateString) => {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('ar-EG');
                };
                
                // Ø¹Ø±Ø¶ ÙƒÙˆØ¯ Ø§Ù„Ø£Ù… Ø¨ØµÙŠØºØ© 'M004' Ø£Ùˆ 'F001' Ø¥Ù† ÙˆÙØ¬Ø¯Øª Ø§Ù„Ù„Ø§Ø­Ù‚Ø©
                const formatMotherDisplay = (fullCode) => {
                    try {
                        if (!fullCode) return '';
                        const m = String(fullCode).match(/-(?:M|F)\d+$/i);
                        if (m) return m[0].replace(/^-/, '').toUpperCase();
                        return String(fullCode);
                    } catch (e) { return String(fullCode || ''); }
                };

                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${newborn.barnNumber}</td>
                    <td>${formatMotherDisplay(newborn.motherCode) || ''}</td>
                    <td>${newborn.gender}</td>
                    <td>${newborn.twin}</td>
                    <td>${newborn.birthPlace}</td>
                    <td>${formatDate(newborn.birthDate)}</td>
                    <td>${newborn.ageMonths} Ø´Ù‡Ø±</td>
                    <td>${newborn.status}</td>
                    <td>${newborn.barnCode}</td>
                    <td>${newborn.newbornCode}</td>
                    <td>${newborn.newbornCard}</td>
                    <td>${formatDate(newborn.addedDate)}</td>
                    <td>
                        <button class="btn btn-warning btn-small edit-btn" data-id="${newborn.id}">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-danger btn-small delete-btn" data-id="${newborn.id}">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù
            tbody.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    openEditModal(parseInt(this.dataset.id));
                });
            });
            
            tbody.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    openDeleteModal(parseInt(this.dataset.id));
                });
            });
        }

        function updateStatistics() {
            const total = newbornData.length;
            const males = newbornData.filter(n => n.gender === 'Ø°ÙƒØ±').length;
            const females = newbornData.filter(n => n.gender === 'Ø£Ù†Ø«Ù‰').length;
            const existing = newbornData.filter(n => n.status === 'Ù…ÙˆØ¬ÙˆØ¯').length;
            const ready = newbornData.filter(n => n.status === 'Ø¬Ø§Ù‡Ø²').length;
            const sold = newbornData.filter(n => n.status === 'Ù…Ø¨Ø§Ø¹').length;
            const dead = newbornData.filter(n => n.status === 'Ù†Ø§ÙÙ‚').length;
            const lost = newbornData.filter(n => n.status === 'Ù…ÙÙ‚ÙˆØ¯').length;
            
            document.getElementById('total-label').textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯: ${total}`;
            document.getElementById('males-label').textContent = `Ø§Ù„Ø°ÙƒÙˆØ±: ${males}`;
            document.getElementById('females-label').textContent = `Ø§Ù„Ø¥Ù†Ø§Ø«: ${females}`;
            document.getElementById('existing-label').textContent = `Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯: ${existing}`;
            document.getElementById('ready-label').textContent = `Ø§Ù„Ø¬Ø§Ù‡Ø²: ${ready}`;
            document.getElementById('sold-label').textContent = `Ø§Ù„Ù…Ø¨Ø§Ø¹: ${sold}`;
            document.getElementById('dead-label').textContent = `Ø§Ù„Ù†Ø§ÙÙ‚: ${dead}`;
            document.getElementById('lost-label').textContent = `Ø§Ù„Ù…ÙÙ‚ÙˆØ¯: ${lost}`;
        }

        // ==========================================================
        //                ğŸŸ¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        // ==========================================================
        function switchTab(tabName) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ÙˆØ§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ù„Ù„ØªØ¨ÙˆÙŠØ¨ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // ==========================================================
        //                ğŸŸ¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        // ==========================================================
        function openEditModal(id) {
            const newborn = newbornData.find(n => n.id === id);
            if (!newborn) return;
            
            currentEditId = id;
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('edit-newborn-code').textContent = newborn.newbornCode;
            document.getElementById('edit-newborn-card').textContent = newborn.newbornCard;
            // Ø¹Ø±Ø¶ ÙƒÙˆØ¯ Ø§Ù„Ø£Ù… Ø¨ØµÙŠØºØ© 'M004' Ø£Ùˆ 'F001' Ø¥Ù† ÙˆÙØ¬Ø¯Øª Ø§Ù„Ù„Ø§Ø­Ù‚Ø©
            const formatMotherDisplay = (fullCode) => {
                try {
                    if (!fullCode) return '';
                    const m = String(fullCode).match(/-(?:M|F)\d+$/i);
                    if (m) return m[0].replace(/^-/, '').toUpperCase();
                    return String(fullCode);
                } catch (e) { return String(fullCode || ''); }
            };
            document.getElementById('edit-mother-code').textContent = formatMotherDisplay(newborn.motherCode || '');
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            let currentStatus = newborn.status;
            if (currentStatus === "Ø­ÙŠ") currentStatus = "Ù…ÙˆØ¬ÙˆØ¯";
            else if (currentStatus === "Ù…ÙŠØª") currentStatus = "Ù†Ø§ÙÙ‚";
            
            document.getElementById('edit-status-combo').value = currentStatus;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            document.getElementById('edit-modal').style.display = 'flex';
        }

        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
            currentEditId = null;
        }

        function saveEdit() {
            if (currentEditId === null) return;
            
            const newStatus = document.getElementById('edit-status-combo').value;
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const newbornIndex = newbornData.findIndex(n => n.id === currentEditId);
            if (newbornIndex !== -1) {
                newbornData[newbornIndex].status = newStatus;
                setLocalStorage('newborns', newbornData);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                updateAllTables();
                updateStatistics();
                
                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
                closeEditModal();
                
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                alert(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ø¥Ù„Ù‰ ${newStatus}`);
            }
        }

        function openDeleteModal(id) {
            const newborn = newbornData.find(n => n.id === id);
            if (!newborn) return;
            
            currentDeleteId = id;
            document.getElementById('delete-message').textContent = 
                `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ø¨Ø±Ù‚Ù… ${newborn.newbornCode}ØŸ`;
            
            document.getElementById('delete-modal').style.display = 'flex';
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').style.display = 'none';
            currentDeleteId = null;
        }

        function confirmDelete() {
            if (currentDeleteId === null) return;
            
            // Ø­Ø°Ù Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            newbornData = newbornData.filter(n => n.id !== currentDeleteId);
            setLocalStorage('newborns', newbornData);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateAllTables();
            updateStatistics();
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            closeDeleteModal();
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function deleteSelectedNewborn() {
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ø´Ø·
            const activeTab = document.querySelector('.tab.active');
            if (!activeTab) return;
            
            const tableId = `${activeTab.dataset.tab}-table`;
            const table = document.getElementById(tableId);
            const selectedRow = table.querySelector('tbody tr.selected');
            
            if (!selectedRow) {
                alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ„ÙˆØ¯ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø­Ø°ÙÙ‡');
                return;
            }
            
            const idCell = selectedRow.cells[0];
            const id = parseInt(idCell.textContent);
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const newborn = newbornData.find(n => n.id === id);
            if (!newborn) return;
            
            openDeleteModal(newborn.id);
        }

        // ==========================================================
        //                ğŸŸ¦ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø­Ø§Ù„Ø§Øª
        // ==========================================================
        function autoUpdateStatusByAge() {
            let updatedCount = 0;
            let existUpdated = 0;
            
            newbornData.forEach(newborn => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø± Ø¨Ø§Ù„Ø£Ø´Ù‡Ø± Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯
                const birthDate = new Date(newborn.birthDate);
                const today = new Date();
                
                let months = (today.getFullYear() - birthDate.getFullYear()) * 12;
                months -= birthDate.getMonth();
                months += today.getMonth();
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ø± >= 3 Ø£Ø´Ù‡Ø± ÙˆØ§Ù„Ø­Ø§Ù„Ø© Ù„ÙŠØ³Øª Ù…Ø¨Ø§Ø¹/Ù†Ø§ÙÙ‚/Ù…ÙÙ‚ÙˆØ¯
                if (months >= 3 && !['Ù…Ø¨Ø§Ø¹', 'Ù†Ø§ÙÙ‚', 'Ù…ÙÙ‚ÙˆØ¯'].includes(newborn.status)) {
                    if (newborn.status !== 'Ø¬Ø§Ù‡Ø²') {
                        newborn.status = 'Ø¬Ø§Ù‡Ø²';
                        updatedCount++;
                    }
                }
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ø± < 3 Ø£Ø´Ù‡Ø± ÙˆØ§Ù„Ø­Ø§Ù„Ø© Ù„ÙŠØ³Øª Ù…Ø¨Ø§Ø¹/Ù†Ø§ÙÙ‚/Ù…ÙÙ‚ÙˆØ¯
                else if (months < 3 && !['Ù…Ø¨Ø§Ø¹', 'Ù†Ø§ÙÙ‚', 'Ù…ÙÙ‚ÙˆØ¯'].includes(newborn.status)) {
                    if (newborn.status !== 'Ù…ÙˆØ¬ÙˆØ¯') {
                        newborn.status = 'Ù…ÙˆØ¬ÙˆØ¯';
                        existUpdated++;
                    }
                }
            });
            
            if (updatedCount > 0 || existUpdated > 0) {
                setLocalStorage('newborns', newbornData);
                updateAllTables();
                updateStatistics();
                
                console.log(`Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ: ØªÙ… ØªØ­Ø¯ÙŠØ« ${updatedCount} Ø³Ø¬Ù„(Ø³) Ø¥Ù„Ù‰ 'Ø¬Ø§Ù‡Ø²' Ùˆ ${existUpdated} Ø³Ø¬Ù„(Ø³) Ø¥Ù„Ù‰ 'Ù…ÙˆØ¬ÙˆØ¯'`);
            }
        }

        function manualAutoUpdate() {
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªÙ‚Ø¯Ù…
            alert('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹...');
            
            // ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ­Ø¯ÙŠØ«
            autoUpdateStatusByAge();
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
            alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ==========================================================
        //                ğŸŸ¦ ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ==========================================================
        function goBack() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ')) {
                // ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„ÙˆÙŠØ¨ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø£Ø®Ø±Ù‰
                // window.location.href = 'index.html';
                alert('Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
            }
        }

        // Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© selected Ù„Ù„ØµÙ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡
        document.addEventListener('click', function(e) {
            if (e.target.tagName === 'TD' || e.target.tagName === 'TR') {
                const row = e.target.tagName === 'TD' ? e.target.parentElement : e.target;
                
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ
                document.querySelectorAll('table tr').forEach(r => {
                    r.classList.remove('selected');
                });
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„Ù„ØµÙ Ø§Ù„Ù…Ø®ØªØ§Ø±
                row.classList.add('selected');
            }
        });
    </script>
</body>
</html>