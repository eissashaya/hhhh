<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ  Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¸Ø§Ø¦Ø±</title>
    <style>
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¹Ø§Ù…Ø© */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 3px solid #3498db;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
        .header {
            background: linear-gradient(to right, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #2980b9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: bold;
            margin: 0;
        }

        .back-btn {
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid #e74c3c;
        }

        .back-btn:hover {
            background: linear-gradient(to bottom, #c0392b, #a93226);
            border-color: #c0392b;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats {
            background: linear-gradient(to right, #27ae60, #2ecc71);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin: 15px;
            display: flex;
            justify-content: space-around;
            border: 2px solid #27ae60;
        }

        .stats div {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 16px;
            font-weight: bold;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
        .columns {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 15px;
        }

        .column {
            flex: 1;
            min-width: 250px;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .column-1 {
            border: 2px solid #3498db;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
        }

        .column-2 {
            border: 2px solid #e67e22;
            background: linear-gradient(to bottom, #fef9e7, #fcf3cf);
        }

        .column-3 {
            border: 2px solid #9b59b6;
            background: linear-gradient(to bottom, #f4ecf7, #e8daef);
        }

        .column-4 {
            border: 2px solid #1abc9c;
            background: linear-gradient(to bottom, #e8f6f3, #d1f2eb);
        }

        .column-5 {
            border: 2px solid #f39c12;
            background: linear-gradient(to bottom, #fef5e7, #fdebd0);
        }

        .column-title {
            background: linear-gradient(to bottom, #34495e, #2c3e50);
            color: white;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid #2c3e50;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #dcdde1;
            border-radius: 8px;
            font-size: 14px;
            background-color: white;
        }

        input:focus, select:focus {
            border-color: #3498db;
            background-color: #ecf0f1;
            outline: none;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .btn-new {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            color: white;
            border: 2px solid #3498db;
        }

        .btn-save {
            background: linear-gradient(to bottom, #27ae60, #219a52);
            color: white;
            border: 2px solid #27ae60;
        }

        .btn-view {
            background: linear-gradient(to bottom, #9b59b6, #8e44ad);
            color: white;
            border: 2px solid #9b59b6;
        }

        .btn-delete {
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
            color: white;
            border: 2px solid #e74c3c;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        .table-container {
            margin: 15px;
            border: 2px solid #34495e;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .table-title {
            background: linear-gradient(to right, #2c3e50, #34495e);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            border-bottom: 2px solid #2c3e50;
        }

        .table-wrapper {
            max-height: 500px;
            overflow-y: auto;
            overflow-x: auto;
            position: relative;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            min-width: 1200px; /* Ø¹Ø±Ø¶ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù†Ø¶ØºØ§Ø· Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
        }

        .data-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table th {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            border-right: 1px solid #2980b9;
            position: sticky;
            top: 0;
        }

        .data-table td {
            padding: 8px;
            border-bottom: 1px solid #ecf0f1;
            text-align: center;
        }

        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .data-table tr:hover {
            background-color: #e3f2fd;
            cursor: pointer;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
        .alert {
            background: linear-gradient(to bottom, #ff6b6b, #ee5a52);
            color: white;
            padding: 12px;
            border: 2px solid #e74c3c;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        /* ØªØ®ØµÙŠØµ Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .day-name {
            background: linear-gradient(to bottom, #2ecc71, #27ae60);
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            border: 2px solid #27ae60;
        }

        .total-price {
            background: linear-gradient(to bottom, #e8f4ff, #d6eaf8);
            border: 2px solid #3498db;
            color: #2980b9;
            font-weight: bold;
        }

        .capacity-input {
            background-color: #e8f6f3;
            border: 2px solid #1abc9c;
            color: #16a085;
            font-weight: bold;
        }

        /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        .table-wrapper::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        .table-wrapper::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 10px;
        }

        .table-wrapper::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 10px;
        }

        .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }

        .table-wrapper::-webkit-scrollbar-corner {
            background: #f0f0f0;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 1200px) {
            .columns {
                flex-direction: column;
            }
            
            .column {
                min-width: 100%;
            }
            
            .buttons {
                flex-wrap: wrap;
            }
            
            .btn {
                flex: 1;
                min-width: 150px;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .data-table {
                font-size: 12px;
            }
            
            .data-table th, .data-table td {
                padding: 6px 4px;
            }
            
            .table-wrapper {
                max-height: 400px;
            }
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .loading {
            display: none;
            text-align: center;
            padding: 10px;
            color: #3498db;
            font-weight: bold;
        }

        .success-message {
            display: none;
            background: linear-gradient(to bottom, #2ecc71, #27ae60);
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin: 10px 15px;
            font-weight: bold;
        }

        .error-message {
            display: none;
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin: 10px 15px;
            font-weight: bold;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø­Ù‚Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø© */
        .barn-number-container {
            position: relative;
        }

        .barn-number-status {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
        }

        .available {
            color: #27ae60;
        }

        .taken {
            color: #e74c3c;
        }

        /* Ù…Ø¤Ø´Ø± Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ */
        .row-count {
            background: #f8f9fa;
            padding: 8px 15px;
            text-align: left;
            font-size: 14px;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø®ØªØ§Ø± */
        .selected-row {
            background-color: #d6eaf8 !important;
            border-left: 3px solid #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ -->
        <div class="header">
            <button class="back-btn" onclick="goBack()">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <h1>ğŸ  Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¸Ø§Ø¦Ø±</h1>
        </div>

        <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ -->
        <div class="success-message" id="success-message"></div>

        <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ -->
        <div class="error-message" id="error-message"></div>

        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats">
            <div id="total-barns">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¸Ø§Ø¦Ø±: 0</div>
            <div id="total-animals">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª: 0</div>
        </div>

        <!-- Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø®Ù…Ø³Ø© -->
        <div class="columns">
            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¸ÙŠØ±Ø© -->
            <div class="column column-1">
                <div class="column-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</div>
                <div class="form-group barn-number-container">
                    <label for="barn-number">Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©:</label>
                    <select id="barn-number">
                        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </select>
                    <span class="barn-number-status" id="barn-number-status">âœ“</span>
                </div>
                <div class="form-group">
                    <label for="barn-name">Ø§Ø³Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©:</label>
                    <input type="text" id="barn-name" placeholder="Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" readonly>
                </div>
                <div class="form-group">
                    <label for="capacity">Ø§Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨:</label>
                    <input type="number" id="capacity" class="capacity-input" min="0" max="10000" value="0">
                </div>
            </div>

            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª -->
            <div class="column column-2">
                <div class="column-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª</div>
                <div class="form-group">
                    <label for="animal-type">Ø§Ù„ØµÙ†Ù:</label>
                    <select id="animal-type">
                        <option value="Ø£ØºÙ†Ø§Ù…">Ø£ØºÙ†Ø§Ù…</option>
                        <option value="Ø£Ø¨Ù‚Ø§Ø±">Ø£Ø¨Ù‚Ø§Ø±</option>
                        <option value="Ù…Ø§Ø¹Ø²">Ù…Ø§Ø¹Ø²</option>
                        <option value="Ø¬Ù…Ø§Ù„">Ø¬Ù…Ø§Ù„</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="gender">Ø§Ù„Ù†ÙˆØ¹:</label>
                    <select id="gender">
                        <option value="Ø­Ø±ÙŠ">Ø­Ø±ÙŠ</option>
                        <option value="Ù†Ø¬Ø¯ÙŠ">Ù†Ø¬Ø¯ÙŠ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="location">Ø§Ù„Ù…ÙˆÙ‚Ø¹:</label>
                    <select id="location">
                        <option value="Ø´Ù…Ø§Ù„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©">Ø´Ù…Ø§Ù„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</option>
                        <option value="Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©">Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</option>
                        <option value="Ø´Ø±Ù‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©">Ø´Ø±Ù‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</option>
                        <option value="ØºØ±Ø¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©">ØºØ±Ø¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</option>
                        <option value="ÙˆØ³Ø· Ø§Ù„Ù…Ø²Ø±Ø¹Ø©">ÙˆØ³Ø· Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</option>
                    </select>
                </div>
            </div>

            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„ÙƒÙ…ÙŠØ§Øª -->
            <div class="column column-3">
                <div class="column-title">Ø§Ù„ÙƒÙ…ÙŠØ§Øª</div>
                <div class="form-group">
                    <label for="male-qty">ÙƒÙ…ÙŠØ© Ø§Ù„Ø°ÙƒÙˆØ±:</label>
                    <input type="number" id="male-qty" min="0" max="10000" value="0">
                </div>
                <div class="form-group">
                    <label for="female-qty">ÙƒÙ…ÙŠØ© Ø§Ù„Ø¥Ù†Ø§Ø«:</label>
                    <input type="number" id="female-qty" min="0" max="10000" value="0">
                </div>
                <div class="form-group">
                    <label for="total-quantity">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</label>
                    <input type="number" id="total-quantity" class="capacity-input" min="0" max="20000" value="0" readonly>
                </div>
            </div>

            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…Ø´Ø±Ù -->
            <div class="column column-4">
                <div class="column-title">Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…Ø´Ø±Ù</div>
                <div class="form-group">
                    <label for="hijri-date">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ:</label>
                    <input type="text" id="hijri-date" readonly>
                </div>
                <div class="form-group">
                    <label for="gregorian-date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡:</label>
                    <input type="date" id="gregorian-date">
                </div>
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„ÙŠÙˆÙ…:</label>
                    <div class="day-name" id="day-name"></div>
                </div>
                <div class="form-group">
                    <label for="supervisor">Ø§Ù„Ù…Ø´Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</label>
                    <select id="supervisor">
                        <option value="Ø¹ÙŠØ³Ù‰ Ø´Ø§ÙŠØ¹">Ø¹ÙŠØ³Ù‰ Ø´Ø§ÙŠØ¹</option>
                        <option value="Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯">Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯</option>
                        <option value="Ø®Ø§Ù„Ø¯ Ø³Ø§Ù„Ù…">Ø®Ø§Ù„Ø¯ Ø³Ø§Ù„Ù…</option>
                        <option value="Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ">Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ</option>
                    </select>
                </div>
            </div>

            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø®Ø§Ù…Ø³: Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
            <div class="column column-5">
                <div class="column-title">Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡</div>
                <div class="form-group">
                    <label for="unit-price">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ:</label>
                    <input type="text" id="unit-price" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ...">
                </div>
                <div class="form-group">
                    <label for="total-price">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¹Ø±:</label>
                    <input type="text" id="total-price" class="total-price" readonly placeholder="Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹">
                </div>
                <div class="alert" id="alert-label"></div>
            </div>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
        <div class="buttons">
            <button class="btn btn-new" onclick="clearFields()">ğŸ†• Ø¬Ø¯ÙŠØ¯</button>
            <button class="btn btn-save" onclick="saveBarn()">ğŸ’¾ Ø­ÙØ¸</button>
            <button class="btn btn-view" onclick="loadData()">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="btn btn-delete" onclick="deleteBarn()">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </div>

        <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
        <div class="loading" id="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...</div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div class="table-container">
            <div class="table-title">ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¸Ø§Ø¦Ø±</div>
            <div class="table-wrapper" id="table-wrapper">
                <table class="data-table" id="data-table">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡</th>
                            <th>Ø§Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨</th>
                            <th>Ø§Ù„ØµÙ†Ù</th>
                            <th>Ø§Ù„ÙŠÙˆÙ…/Ø§Ù„Ø´Ù‡Ø±</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                            <th>ÙƒÙ…ÙŠØ© Ø°ÙƒÙˆØ±</th>
                            <th>ÙƒÙ…ÙŠØ© Ø¥Ù†Ø§Ø«</th>
                            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ</th>
                            <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¹Ø±</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                    </tbody>
                </table>
            </div>
            <div class="row-count" id="row-count">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ: 0</div>
        </div>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let selectedId = null;
        let barns = [];
        let selectedRow = null;
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¸Ø§Ø¦Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
        const barnData = {
            "1": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰", "location": "Ø´Ù…Ø§Ù„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 200},
            "2": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©", "location": "Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 300},
            "3": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©", "location": "Ø´Ø±Ù‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 200},
            "4": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©", "location": "ØºØ±Ø¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 300},
            "5": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©", "location": "ÙˆØ³Ø· Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 200},
            "6": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø³Ø§Ø¯Ø³Ø©", "location": "Ø´Ù…Ø§Ù„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 300},
            "7": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ø¹Ø©", "location": "Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 200},
            "8": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø«Ø§Ù…Ù†Ø©", "location": "Ø´Ø±Ù‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 300},
            "9": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„ØªØ§Ø³Ø¹Ø©", "location": "ØºØ±Ø¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 200},
            "10": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø¹Ø§Ø´Ø±Ø©", "location": "ÙˆØ³Ø· Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 300},
            "11": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø­Ø§Ø¯ÙŠØ© Ø¹Ø´Ø±", "location": "Ø´Ù…Ø§Ù„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 200},
            "12": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø¹Ø´Ø±", "location": "Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 300},
            "13": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ø¹Ø´Ø±", "location": "Ø´Ø±Ù‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 200},
            "14": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ø¹Ø´Ø±", "location": "ØºØ±Ø¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 300},
            "15": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø© Ø¹Ø´Ø±", "location": "ÙˆØ³Ø· Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 200},
            "16": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø³Ø§Ø¯Ø³Ø© Ø¹Ø´Ø±", "location": "Ø´Ù…Ø§Ù„ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 300},
            "17": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ø¹Ø© Ø¹Ø´Ø±", "location": "Ø¬Ù†ÙˆØ¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 200},
            "18": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø«Ø§Ù…Ù†Ø© Ø¹Ø´Ø±", "location": "Ø´Ø±Ù‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 300},
            "19": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„ØªØ§Ø³Ø¹Ø© Ø¹Ø´Ø±", "location": "ØºØ±Ø¨ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 200},
            "20": {"name": "Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø¹Ø´Ø±ÙˆÙ†", "location": "ÙˆØ³Ø· Ø§Ù„Ù…Ø²Ø±Ø¹Ø©", "capacity": 300}
        };

        // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ù„ÙƒÙ„ ØµÙ†Ù
        const animalTypesMapping = {
            "Ø£ØºÙ†Ø§Ù…": ["Ø­Ø±ÙŠ", "Ù†Ø¬Ø¯ÙŠ"],
            "Ø£Ø¨Ù‚Ø§Ø±": ["Ù†Ø¬Ø¯ÙŠ", "Ø­Ø±ÙŠ"],
            "Ù…Ø§Ø¹Ø²": ["Ø´Ø§Ù…ÙŠ", "Ø­Ø±ÙŠ"],
            "Ø¬Ù…Ø§Ù„": ["Ù†Ø¬Ø¯ÙŠ", "Ø­Ø±ÙŠ"]
        };

        // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        const arabicNumbers = {
            1: "Ø§Ù„Ø£ÙˆÙ„Ù‰",
            2: "Ø§Ù„Ø«Ø§Ù†ÙŠØ©", 
            3: "Ø§Ù„Ø«Ø§Ù„Ø«Ø©",
            4: "Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©",
            5: "Ø§Ù„Ø®Ø§Ù…Ø³Ø©",
            6: "Ø§Ù„Ø³Ø§Ø¯Ø³Ø©",
            7: "Ø§Ù„Ø³Ø§Ø¨Ø¹Ø©",
            8: "Ø§Ù„Ø«Ø§Ù…Ù†Ø©",
            9: "Ø§Ù„ØªØ§Ø³Ø¹Ø©",
            10: "Ø§Ù„Ø¹Ø§Ø´Ø±Ø©",
            11: "Ø§Ù„Ø­Ø§Ø¯ÙŠØ© Ø¹Ø´Ø±",
            12: "Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø¹Ø´Ø±",
            13: "Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ø¹Ø´Ø±",
            14: "Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ø¹Ø´Ø±",
            15: "Ø§Ù„Ø®Ø§Ù…Ø³Ø© Ø¹Ø´Ø±",
            16: "Ø§Ù„Ø³Ø§Ø¯Ø³Ø© Ø¹Ø´Ø±",
            17: "Ø§Ù„Ø³Ø§Ø¨Ø¹Ø© Ø¹Ø´Ø±",
            18: "Ø§Ù„Ø«Ø§Ù…Ù†Ø© Ø¹Ø´Ø±",
            19: "Ø§Ù„ØªØ§Ø³Ø¹Ø© Ø¹Ø´Ø±",
            20: "Ø§Ù„Ø¹Ø´Ø±ÙˆÙ†"
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
            const today = new Date();
            document.getElementById('gregorian-date').valueAsDate = today;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙˆØ§Ø³Ù… Ø§Ù„ÙŠÙˆÙ…
            updateHijriDate();
            updateDayName();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
            updateTotals();

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            loadFromLocalStorage();
            // ØªÙ‡ÙŠØ¦Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø«Ù… ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            updateBarnNumberOptions();
            setAutoBarnNumber();
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
            loadData();
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            document.getElementById('barn-number').addEventListener('change', updateBarnData);
            document.getElementById('animal-type').addEventListener('change', updateAnimalTypes);
            document.getElementById('male-qty').addEventListener('input', updateTotals);
            document.getElementById('female-qty').addEventListener('input', updateTotals);
            document.getElementById('unit-price').addEventListener('input', updateTotals);
            document.getElementById('gregorian-date').addEventListener('change', function() {
                updateHijriDate();
                updateDayName();
            });
            document.getElementById('male-qty').addEventListener('input', checkCapacity);
            document.getElementById('female-qty').addEventListener('input', checkCapacity);
            document.getElementById('capacity').addEventListener('input', checkCapacity);
            
            // ØªØ¹ÙŠÙŠÙ† Ø£ÙˆÙ„ Ø±Ù‚Ù… Ø­Ø¸ÙŠØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            setAutoBarnNumber();
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø­Ø¸Ø§Ø¦Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©
            updateBarnNumberOptions();
        });

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø­Ø¸Ø§Ø¦Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©
        function updateBarnNumberOptions() {
            const barnNumberSelect = document.getElementById('barn-number');
            const currentValue = barnNumberSelect.value;
            
            // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            barnNumberSelect.innerHTML = '';
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
            const usedNumbers = barns.map(barn => barn.barnNumber);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
            for (let i = 1; i <= 20; i++) {
                const option = document.createElement('option');
                option.value = i.toString();
                option.textContent = i.toString();
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ù…Ø³ØªØ®Ø¯Ù…Ù‹Ø§ØŒ Ù†Ø¶ÙŠÙ Ø¹Ù„Ø§Ù…Ø© (Ù…Ø³ØªØ®Ø¯Ù…)
                if (usedNumbers.includes(i.toString())) {
                    option.textContent += ' (Ù…Ø³ØªØ®Ø¯Ù…)';
                    option.disabled = true;
                }
                
                barnNumberSelect.appendChild(option);
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯
            const customOption = document.createElement('option');
            customOption.value = 'custom';
            customOption.textContent = 'Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯...';
            barnNumberSelect.appendChild(customOption);
            
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ø§ ØªØ²Ø§Ù„ Ù…ØªØ§Ø­Ø©
            if (currentValue && barnNumberSelect.querySelector(`option[value="${currentValue}"]`) && 
                !barnNumberSelect.querySelector(`option[value="${currentValue}"]`).disabled) {
                barnNumberSelect.value = currentValue;
            } else {
                // ØªØ¹ÙŠÙŠÙ† Ø£ÙˆÙ„ Ø±Ù‚Ù… Ù…ØªØ§Ø­
                setAutoBarnNumber();
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
            checkBarnNumberStatus();
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
        function checkBarnNumberStatus() {
            const barnNumber = document.getElementById('barn-number').value;
            const statusElement = document.getElementById('barn-number-status');
            
            if (barnNumber === 'custom') {
                statusElement.textContent = 'âœ';
                statusElement.className = 'barn-number-status';
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ù…Ø³ØªØ®Ø¯Ù…Ù‹Ø§
            const isUsed = barns.some(barn => barn.barnNumber === barnNumber);
            
            if (isUsed) {
                statusElement.textContent = 'âœ—';
                statusElement.className = 'barn-number-status taken';
            } else {
                statusElement.textContent = 'âœ“';
                statusElement.className = 'barn-number-status available';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±
        function updateBarnData() {
            const selectedNumber = document.getElementById('barn-number').value;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
            checkBarnNumberStatus();
            
            // Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± "Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯"ØŒ Ù†ØªÙŠØ­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù…
            if (selectedNumber === 'custom') {
                const customNumber = prompt('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯:');
                if (customNumber) {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…
                    if (barns.some(barn => barn.barnNumber === customNumber)) {
                        showMessage('Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ù‡Ø°Ø§ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹!', 'error');
                        setAutoBarnNumber();
                        return;
                    }
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    const barnNumberSelect = document.getElementById('barn-number');
                    const newOption = document.createElement('option');
                    newOption.value = customNumber;
                    newOption.textContent = customNumber;
                    barnNumberSelect.insertBefore(newOption, barnNumberSelect.lastChild);
                    barnNumberSelect.value = customNumber;
                } else {
                    setAutoBarnNumber();
                    return;
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            if (selectedNumber in arabicNumbers) {
                document.getElementById('barn-name').value = `Ø§Ù„Ø­Ø¸ÙŠØ±Ø© ${arabicNumbers[selectedNumber]}`;
            } else {
                document.getElementById('barn-name').value = `Ø§Ù„Ø­Ø¸ÙŠØ±Ø© ${selectedNumber}`;
            }
            
            if (barnData[selectedNumber]) {
                document.getElementById('capacity').value = barnData[selectedNumber].capacity;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹
                const locationSelect = document.getElementById('location');
                for (let i = 0; i < locationSelect.options.length; i++) {
                    if (locationSelect.options[i].value === barnData[selectedNumber].location) {
                        locationSelect.selectedIndex = i;
                        break;
                    }
                }
            } else {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ù…ÙˆØ³
                const barnNum = parseInt(selectedNumber);
                const capacityValue = (barnNum % 2 === 1) ? 200 : 300;
                document.getElementById('capacity').value = capacityValue;
                
                // ØªØ¹ÙŠÙŠÙ† Ù…ÙˆÙ‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ
                const locationIndex = barnNum % 5;
                document.getElementById('location').selectedIndex = locationIndex;
            }
        }

        // ØªØ¹ÙŠÙŠÙ† Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        function setAutoBarnNumber() {
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¸Ø§Ø¦Ø± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
            let nextNumber = 1;
            const usedNumbers = barns.map(barn => parseInt(barn.barnNumber)).filter(num => !isNaN(num));
            
            if (usedNumbers.length > 0) {
                nextNumber = Math.max(...usedNumbers) + 1;
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø±Ù‚Ù… Ù…ØªØ§Ø­
            while (barns.some(barn => barn.barnNumber === nextNumber.toString())) {
                nextNumber++;
            }
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø±Ù‚Ù… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
            const barnNumberSelect = document.getElementById('barn-number');
            if (barnNumberSelect.querySelector(`option[value="${nextNumber}"]`) && 
                !barnNumberSelect.querySelector(`option[value="${nextNumber}"]`).disabled) {
                barnNumberSelect.value = nextNumber.toString();
            } else {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø±Ù‚Ù… Ù…ØªØ§Ø­
                for (let i = 1; i <= 20; i++) {
                    const option = barnNumberSelect.querySelector(`option[value="${i}"]`);
                    if (option && !option.disabled) {
                        barnNumberSelect.value = i.toString();
                        break;
                    }
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
            updateBarnData();
        }

        // ØªØ­Ø¯ÙŠØ« Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ†Ù Ø§Ù„Ù…Ø®ØªØ§Ø±
        function updateAnimalTypes() {
            const selectedAnimal = document.getElementById('animal-type').value;
            const genderSelect = document.getElementById('gender');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            genderSelect.innerHTML = '';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            if (animalTypesMapping[selectedAnimal]) {
                animalTypesMapping[selectedAnimal].forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    genderSelect.appendChild(option);
                });
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        function updateTotals() {
            const maleQty = parseInt(document.getElementById('male-qty').value) || 0;
            const femaleQty = parseInt(document.getElementById('female-qty').value) || 0;
            const totalQty = maleQty + femaleQty;
            
            document.getElementById('total-quantity').value = totalQty;
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¹Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ Ø§Ù„Ù…Ø¯Ø®Ù„
            const unitPriceText = document.getElementById('unit-price').value.trim();
            if (unitPriceText) {
                try {
                    const unitPrice = parseFloat(unitPriceText.replace(/,/g, ''));
                    if (!isNaN(unitPrice)) {
                        const totalPrice = unitPrice * totalQty;
                        document.getElementById('total-price').value = formatPrice(totalPrice, false);
                    }
                } catch (e) {
                    document.getElementById('total-price').value = '0';
                }
            } else {
                document.getElementById('total-price').value = '0';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ù…Ø¹ Ø­Ù…Ø§ÙŠØ© Ù…Ù† ØªÙˆØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­Ø©)
        function updateHijriDate() {
            const raw = document.getElementById('gregorian-date').value;
            if (!raw) {
                document.getElementById('hijri-date').value = '';
                return;
            }
            const gregorianDate = new Date(raw);
            if (isNaN(gregorianDate.getTime())) {
                document.getElementById('hijri-date').value = '';
                return;
            }
            const hijriDate = convertToHijri(gregorianDate);
            document.getElementById('hijri-date').value = hijriDate;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ø¹ Ø­Ù…Ø§ÙŠØ© Ù…Ù† ØªÙˆØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­Ø©)
        function updateDayName() {
            const raw = document.getElementById('gregorian-date').value;
            if (!raw) {
                document.getElementById('day-name').textContent = '';
                return;
            }
            const date = new Date(raw);
            if (isNaN(date.getTime())) {
                document.getElementById('day-name').textContent = '';
                return;
            }
            const dayName = getDayNameArabic(date);
            document.getElementById('day-name').textContent = dayName;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ¬Ø§ÙˆØ² Ø³Ø¹Ø© Ø§Ù„Ø­Ø¸ÙŠØ±Ø©
        function checkCapacity() {
            const maleQty = parseInt(document.getElementById('male-qty').value) || 0;
            const femaleQty = parseInt(document.getElementById('female-qty').value) || 0;
            const totalAnimals = maleQty + femaleQty;
            const capacity = parseInt(document.getElementById('capacity').value) || 0;
            
            const alertLabel = document.getElementById('alert-label');
            
            if (capacity > 0 && totalAnimals > capacity) {
                alertLabel.textContent = `âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ø¹Ø¯Ø¯ ${totalAnimals} ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø¹Ø© ${capacity}`;
                alertLabel.style.display = 'block';
            } else {
                alertLabel.style.display = 'none';
            }
        }

        // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
        function clearFields() {
            selectedId = null;
            selectedRow = null;
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯
            if (selectedRow) {
                selectedRow.classList.remove('selected-row');
            }
            
            document.getElementById('barn-number').selectedIndex = 0;
            document.getElementById('barn-name').value = '';
            document.getElementById('capacity').value = 0;
            document.getElementById('animal-type').selectedIndex = 0;
            document.getElementById('gender').selectedIndex = 0;
            document.getElementById('location').selectedIndex = 0;
            document.getElementById('male-qty').value = 0;
            document.getElementById('female-qty').value = 0;
            document.getElementById('total-quantity').value = 0;
            document.getElementById('gregorian-date').valueAsDate = new Date();
            document.getElementById('supervisor').selectedIndex = 0;
            document.getElementById('unit-price').value = '';
            document.getElementById('total-price').value = '';
            document.getElementById('alert-label').style.display = 'none';
            
            updateHijriDate();
            updateDayName();
            setAutoBarnNumber();
            updateAnimalTypes();
        }

        // Ø­ÙØ¸ Ø§Ù„Ø­Ø¸ÙŠØ±Ø©
        function saveBarn() {
            const barnNumber = document.getElementById('barn-number').value;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!document.getElementById('barn-name').value.trim()) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©.', 'error');
                return;
            }
            
            if (parseInt(document.getElementById('total-quantity').value) === 0) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª.', 'error');
                return;
            }
            
            const unitPriceText = document.getElementById('unit-price').value.trim();
            if (!unitPriceText) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ.', 'error');
                return;
            }
            
            let unitPrice;
            try {
                unitPrice = parseFloat(unitPriceText.replace(/,/g, ''));
                if (isNaN(unitPrice) || unitPrice < 0) {
                    showMessage('Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø±Ù‚Ù… Ù…ÙˆØ¬Ø¨.', 'error');
                    return;
                }
            } catch (e) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ÙØ±Ø¯ÙŠ ØµØ­ÙŠØ­.', 'error');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø© ØºÙŠØ± Ù…ÙƒØ±Ø± (Ù„Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·)
            if (selectedId === null && barns.some(barn => barn.barnNumber === barnNumber)) {
                showMessage('Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ù‡Ø°Ø§ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹! Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù‚Ù… Ø¢Ø®Ø±.', 'error');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ø¹Ø©
            const totalAnimals = parseInt(document.getElementById('total-quantity').value);
            const capacity = parseInt(document.getElementById('capacity').value);
            const alert = (capacity > 0 && totalAnimals > capacity);
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¹Ø±
            const totalPrice = unitPrice * totalAnimals;
            
            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø­Ø¸ÙŠØ±Ø©
            const barn = {
                barnNumber: barnNumber,
                barnName: document.getElementById('barn-name').value,
                capacity: capacity,
                animalType: document.getElementById('animal-type').value,
                gender: document.getElementById('gender').value,
                location: document.getElementById('location').value,
                maleQty: parseInt(document.getElementById('male-qty').value) || 0,
                femaleQty: parseInt(document.getElementById('female-qty').value) || 0,
                totalQuantity: totalAnimals,
                hijriDate: document.getElementById('hijri-date').value,
                gregorianDate: document.getElementById('gregorian-date').value,
                supervisor: document.getElementById('supervisor').value,
                unitPrice: unitPrice,
                totalPrice: totalPrice,
                alert: alert,
                addedDate: new Date().toISOString()
            };
            
            // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            showLoading(true);
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­ÙØ¸ (ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù‚Ø¯ ØªÙƒÙˆÙ† Ù‡Ø°Ù‡ Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†Ø©)
            setTimeout(() => {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (selectedId !== null) {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    barns[selectedId] = barn;
                    showMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                } else {
                    // Ø¥Ø¶Ø§ÙØ© Ø­Ø¸ÙŠØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    barn.id = Date.now().toString(); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ ÙƒÙ…Ø¹Ø±Ù ÙØ±ÙŠØ¯
                    barns.push(barn);
                    showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                }
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
                saveToLocalStorage();
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø­Ø¸Ø§Ø¦Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©
                updateBarnNumberOptions();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
                clearFields();
                loadData();
                
                // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
                showLoading(false);
            }, 500); // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ£Ø®ÙŠØ± Ù‚Ø¯Ø±Ù‡ 500 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
        }

        // Ø­Ø°Ù Ø§Ù„Ø­Ø¸ÙŠØ±Ø©
        function deleteBarn() {
            if (selectedId === null) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø­Ø¸ÙŠØ±Ø© Ø£ÙˆÙ„Ø§Ù‹.', 'error');
                return;
            }
            
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŸ')) {
                showLoading(true);
                
                setTimeout(() => {
                    barns.splice(selectedId, 1);
                    saveToLocalStorage();
                    showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¸ÙŠØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    
                    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø­Ø¸Ø§Ø¦Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©
                    updateBarnNumberOptions();
                    
                    clearFields();
                    loadData();
                    showLoading(false);
                }, 500);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function loadData() {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStatistics();
            // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØºÙ†Ø§Ù… Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
            const sheepData = JSON.parse(localStorage.getItem('sheepData')) || [];
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            barns.forEach((barn, index) => {
                const row = document.createElement('tr');
                row.onclick = () => loadSelectedRow(index, row);
                
                // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ù…Ù† sheepData (Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©)
                const barnKey = barn.barnNumber || barn.barnNum || barn.barnId || barn.barn_id || barn.barn;
                const barnSheep = sheepData.filter(s => String(s.barnNumber) === String(barnKey) || String(s.barnNumber) === String(barn.barnNumber));
                let maleCount = 0;
                let femaleCount = 0;
                let totalCount = 0;
                barnSheep.forEach(s => {
                    const rep = parseInt(s.repeat) || 1;
                    totalCount += rep;
                    if (s.gender === 'Ø°ÙƒØ±') maleCount += rep;
                    else if (s.gender === 'Ø£Ù†Ø«Ù‰') femaleCount += rep;
                });

                // Ø¥Ø°Ø§ Ù„Ù… ØªØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØºÙ†Ø§Ù…ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®Ø²Ù†Ø© ÙÙŠ Ø§Ù„Ø­Ø¸ÙŠØ±Ø© ÙƒÙ€ fallback
                const displayMale = (maleCount > 0) ? maleCount : (barn.maleQty || barn.maleCount || 0);
                const displayFemale = (femaleCount > 0) ? femaleCount : (barn.femaleQty || barn.femaleCount || 0);
                const displayTotal = (totalCount > 0) ? totalCount : (barn.totalQuantity || barn.total || 0);

                const columnsData = [
                    barn.barnNumber || '',
                    barn.barnName || '',
                    formatDate(barn.gregorianDate),
                    barn.capacity || '0',
                    barn.animalType || '',
                    getDayMonth(barn.gregorianDate),
                    barn.gender || '',
                    barn.location || '',
                    displayMale,
                    displayFemale,
                    displayTotal,
                    formatPrice(barn.unitPrice),
                    formatPrice(barn.totalPrice)
                ];
                
                columnsData.forEach((data, colIndex) => {
                    const cell = document.createElement('td');
                    cell.textContent = data;
                    
                    // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø¯ÙŠØ©
                    if (colIndex === 3 || colIndex === 8 || colIndex === 9 || colIndex === 10) {
                        cell.style.backgroundColor = '#f0f0f0';
                    }
                    
                    row.appendChild(cell);
                });
                
                tableBody.appendChild(row);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
            updateRowCount();
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
        function updateRowCount() {
            const rowCount = barns.length;
            document.getElementById('row-count').textContent = `Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ: ${rowCount}`;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
        function loadSelectedRow(index, rowElement) {
            const barn = barns[index];
            selectedId = index;
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¨Ù‚
            if (selectedRow) {
                selectedRow.classList.remove('selected-row');
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù„Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            selectedRow = rowElement;
            selectedRow.classList.add('selected-row');
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            document.getElementById('barn-number').value = barn.barnNumber;
            document.getElementById('barn-name').value = barn.barnName;
            document.getElementById('capacity').value = barn.capacity || 0;
            document.getElementById('animal-type').value = barn.animalType;
            document.getElementById('gender').value = barn.gender;
            document.getElementById('location').value = barn.location;
            document.getElementById('male-qty').value = barn.maleQty || 0;
            document.getElementById('female-qty').value = barn.femaleQty || 0;
            document.getElementById('total-quantity').value = barn.totalQuantity || 0;
            document.getElementById('hijri-date').value = barn.hijriDate;
            document.getElementById('gregorian-date').value = barn.gregorianDate;
            document.getElementById('supervisor').value = barn.supervisor;
            document.getElementById('unit-price').value = formatPrice(barn.unitPrice, false);
            document.getElementById('total-price').value = formatPrice(barn.totalPrice, false);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙˆØ§Ø³Ù… Ø§Ù„ÙŠÙˆÙ…
            updateHijriDate();
            updateDayName();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ø¹Ø©
            checkCapacity();
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø±Ù‚Ù… Ø§Ù„Ø­Ø¸ÙŠØ±Ø©
            checkBarnNumberStatus();
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatistics() {
            const totalBarns = barns.length;

            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØºÙ†Ø§Ù… (sheepData) Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
            const sheepData = JSON.parse(localStorage.getItem('sheepData')) || [];
            let totalAnimals = 0;
            sheepData.forEach(s => {
                totalAnimals += parseInt(s.repeat) || 1;
            });

            // ÙƒØ§Ø­ØªÙŠØ§Ø·ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®Ø²Ù†Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ù…Ù„ Ø¥Ù† Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØºÙ†Ø§Ù…
            if (totalAnimals === 0) {
                totalAnimals = barns.reduce((sum, barn) => sum + (barn.totalQuantity || 0), 0);
            }

            document.getElementById('total-barns').textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¸Ø§Ø¦Ø±: ${totalBarns}`;
            document.getElementById('total-animals').textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª: ${totalAnimals}`;
        }

        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
        function formatDate(dateValue) {
            if (!dateValue) return '';
            try {
                const date = new Date(dateValue);
                return date.toISOString().split('T')[0];
            } catch (e) {
                return String(dateValue);
            }
        }

        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ø¹Ø±
        function formatPrice(priceValue, withCurrency = true) {
            if (priceValue === null || priceValue === undefined) {
                return withCurrency ? '0 Ø±ÙŠØ§Ù„' : '0';
            }
            
            try {
                const num = parseFloat(priceValue);
                if (isNaN(num)) return withCurrency ? '0 Ø±ÙŠØ§Ù„' : '0';
                
                let s = num.toFixed(2);
                s = s.replace(/\.?0+$/, '');
                
                return withCurrency ? `${s} Ø±ÙŠØ§Ù„` : s;
            } catch (e) {
                return withCurrency ? '0 Ø±ÙŠØ§Ù„' : '0';
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ø´Ù‡Ø± Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®
        function getDayMonth(dateValue) {
            if (!dateValue) return '';
            try {
                const date = new Date(dateValue);
                return `${date.getDate()}/${date.getMonth() + 1}`;
            } catch (e) {
                return '';
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        function getDayNameArabic(date) {
            const days = [
                "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", 
                "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"
            ];
            return days[date.getDay()];
        }

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ Ø¥Ù„Ù‰ Ù‡Ø¬Ø±ÙŠ (Ù…Ø­Ø§ÙƒØ§Ø©)
        function convertToHijri(gregorianDate) {
            // Ù‡Ø°Ù‡ Ø¯Ø§Ù„Ø© Ù…Ø­Ø§ÙƒØ§Ø©ØŒ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
            const year = gregorianDate.getFullYear();
            const month = gregorianDate.getMonth() + 1;
            const day = gregorianDate.getDate();
            
            // Ø­Ø³Ø§Ø¨ ØªÙ‚Ø±ÙŠØ¨ÙŠ (Ù„ÙŠØ³ Ø¯Ù‚ÙŠÙ‚Ø§Ù‹)
            const hijriYear = Math.round((year - 622) * (33/32));
            const hijriMonth = month;
            const hijriDay = day;
            
            return `${hijriYear}/${hijriMonth.toString().padStart(2, '0')}/${hijriDay.toString().padStart(2, '0')}`;
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        function saveToLocalStorage() {
            localStorage.setItem('barnsData', JSON.stringify(barns));
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('barnsData');
            if (savedData) {
                barns = JSON.parse(savedData);
            }
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø©
        function showMessage(message, type) {
            const successElement = document.getElementById('success-message');
            const errorElement = document.getElementById('error-message');
            
            if (type === 'success') {
                successElement.textContent = message;
                successElement.style.display = 'block';
                errorElement.style.display = 'none';
            } else if (type === 'error') {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                successElement.style.display = 'none';
            }
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†Ù
            setTimeout(() => {
                successElement.style.display = 'none';
                errorElement.style.display = 'none';
            }, 3000);
        }

        // Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function showLoading(show) {
            const loadingElement = document.getElementById('loading');
            loadingElement.style.display = show ? 'block' : 'none';
        }

        // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â€” Ø§Ø³ØªØ®Ø¯Ù… history.back() Ù…Ø¹ ØªØ±Ø§Ø¬Ø¹ Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        function goBack() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ')) return;
            try {
                if (history.length > 1) {
                    history.back();
                    setTimeout(() => { window.location.href = '../index.html'; }, 300);
                } else {
                    window.location.href = '../index.html';
                }
            } catch (err) {
                window.location.href = '../index.html';
            }
        }
    </script>
</body>
</html>